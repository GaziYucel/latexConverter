(function(e){"use strict";const F=(a,d)=>{const l=a.__vccOpts||a;for(const[r,n]of d)l[r]=n;return l},N=["value"],T=F({__name:"ExtractModal",props:{currentSubmissionFile:{type:Object,required:!0},apiUrl:{type:String,required:!0}},emits:["close"],setup(a,{emit:d}){const{useLocalize:l}=pkp.modules.useLocalize,{useFetch:r}=pkp.modules.useFetch,{t:n,localize:y}=l(),g=e.inject("closeModal"),s=a,{currentSubmissionFile:p,apiUrl:k}=s,x=d,i=e.ref(""),u=e.ref(""),h=async()=>{const{fetch:o,data:t}=r(`${k}/listFiles`,{method:"GET",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken}});await o().then(()=>{u.value=t.value})};e.onMounted(()=>{h()});const S=async()=>{const{fetch:o,data:t}=r(`${k}/extractFiles`,{method:"POST",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken},body:{selectedFile:i.value}});await o().then(()=>{u.value=t.value}),x("close"),g()};function m(){x("close"),g()}const{PkpButton:c,PkpSideModalBody:C,PkpSideModalLayoutBasic:f}=pkp.registry.getAllComponents();return(o,t)=>(e.openBlock(),e.createBlock(e.unref(C),null,{title:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(n)("plugins.generic.latexConverter.modal.extract.header",{archiveName:e.unref(y)(e.unref(p).name)})),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(f),null,{default:e.withCtx(()=>[e.createElementVNode("div",null,e.toDisplayString(e.unref(n)("plugins.generic.latexConverter.modal.extract.title")),1),t[3]||(t[3]=e.createElementVNode("div",null,"  ",-1)),e.createElementVNode("div",null,[e.withDirectives(e.createElementVNode("select",{id:"select-file","onUpdate:modelValue":t[0]||(t[0]=b=>i.value=b),class:"select-file"},[t[1]||(t[1]=e.createElementVNode("option",{value:"",disabled:""},"...",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(b,E)=>(e.openBlock(),e.createElementBlock("option",{key:E,value:b},e.toDisplayString(b),9,N))),128))],512),[[e.vModelSelect,i.value]])]),t[4]||(t[4]=e.createElementVNode("div",null,"  ",-1)),e.createElementVNode("div",null,[e.createVNode(e.unref(c),{onClick:S,isDisabled:!i.value},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(n)("plugins.generic.latexConverter.modal.extract.button")),1)]),_:1},8,["isDisabled"]),t[2]||(t[2]=e.createTextVNode("   ")),e.createVNode(e.unref(c),{onClick:m},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(n)("common.cancel")),1)]),_:1})])]),_:1})]),_:1}))}},[["__scopeId","data-v-184ecdd7"]]);pkp.registry.registerComponent("ExtractModal",T),pkp.registry.storeExtend("fileManager_PRODUCTION_READY_FILES",a=>{const d=pkp.registry.getPiniaStore("dashboard"),l=a.store;if(d.dashboardPage!=="editorialDashboard"||l.props.submissionStageId!==pkp.const.WORKFLOW_STAGE_ID_PRODUCTION)return;const{useModal:r}=pkp.modules.useModal,{useLocalize:n}=pkp.modules.useLocalize,{useUrl:y}=pkp.modules.useUrl,{useFetch:g}=pkp.modules.useFetch,{t:s,localize:p}=n(),{useDataChanged:k}=pkp.modules.useDataChanged,{triggerDataChange:x}=k(),{openSideModal:i,openDialog:u}=r();function h(){x()}l.extender.extendFn("getItemActions",(S,m)=>{let c=S;const{apiUrl:C}=y(`submissions/latexConverter/${m.file.id}`);return p(m.file.name).endsWith(".zip")&&c.push({label:s("plugins.generic.latexConverter.button.extract"),name:"extractAction",icon:"FileZip",actionFn:({file:f})=>{i(T,{currentSubmissionFile:f,apiUrl:C.value,onClose:h})}}),p(m.file.name).endsWith(".tex")&&c.push({label:s("plugins.generic.latexConverter.button.convert"),name:"convertAction",icon:"FileText",actionFn:({file:f})=>{u({title:s("plugins.generic.latexConverter.button.convert"),message:s("plugins.generic.latexConverter.button.message",{fileName:p(f.name)}),actions:[{label:"Yes",isPrimary:!0,callback:async o=>{o();const{fetch:t}=g(`${C.value}/convertTex`,{method:"GET",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken}});await t().then(()=>{h()})}},{label:"No",isWarnable:!0,callback:o=>{o()}}]})}}),[...c]})})})(pkp.modules.vue);
